# FastBotty - User Guide for Configuration & Deployment

> Simple, Powerful, Fast notification framework for Python. Receives HTTP webhooks and forwards them as formatted messages(currently supports only Telegram). Built on FastAPI, python-telegram-bot and aiohttp with plugin support, Jinja2 templates, and comprehensive inline keyboard support.

## Quick Start

```bash
# Install FastBotty
pip install fastbotty

# Create new project
fastbotty init my_notifier
cd my_notifier

# Edit config.yaml with your settings
# Start the server
fastbotty run
```

## Configuration Guide

### Basic Configuration Structure

```yaml
bot:
  token: "${TELEGRAM_BOT_TOKEN}"  # Required: Bot token from @BotFather
  test_mode: false                # Optional: Enable for testing
  webhook_url: "https://your-app.onrender.com"  # Required for webhooks
  webhook_path: "/bot/webhook"   # Default webhook path

endpoints:
  - path: "/notify"              # HTTP POST endpoint path
    chat_id: "123456789"          # Single chat ID
    chat_ids: ["123", "456"]     # Or multiple chat IDs
    formatter: "plain"            # plain, markdown, or custom plugin
    template: "template_name"     # Optional: Use named template
    parse_mode: "MarkdownV2"      # Optional: Telegram parse mode
    labels:                       # Optional: Custom field labels
      field_name: "üè∑Ô∏è Display Name"
    field_map:                    # Optional: Map nested JSON fields
      image_url: "data.photo.url"
    buttons:                      # Optional: Inline keyboard
      - - text: "View Details"
          url: "https://example.com/{{ id }}"

server:
  host: "0.0.0.0"               # Listen on all interfaces
  port: 8000                     # Default port
  api_key: "${API_KEY}"          # Optional: API authentication
  cors_origins: ["*"]           # Optional: CORS settings

logging:
  level: "INFO"                 # Optional: Logging level
```

## Environment Variables

FastBotty supports environment variable substitution with `${VAR_NAME}` syntax:

```bash
# Set required variables
export TELEGRAM_BOT_TOKEN="your-bot-token-from-botfather"
export API_KEY="your-secret-api-key"
export WEBHOOK_URL="https://your-app.onrender.com"
export CHAT_ID="123456789"

# Optional: Set port
export PORT=8000
```

In config.yaml, use variables like:
```yaml
bot:
  token: "${TELEGRAM_BOT_TOKEN}"
server:
  api_key: "${API_KEY}"
  port: "${PORT:-8000}"  # Use PORT env var or default to 8000
```

## Inline Keyboard Buttons

FastBotty supports ALL Telegram inline keyboard button types with Jinja2 template rendering:

### Basic Buttons

#### URL Button
```yaml
buttons:
  - - text: "üîó Visit Website"
      url: "https://example.com/{{ id }}"
```

#### Callback Data Button
```yaml
buttons:
  - - text: "‚úÖ Approve"
      callback_data: "approve_{{ order_id }}"
```

### Advanced Button Types

#### Web App Button
```yaml
buttons:
  - - text: "üöÄ Open Dashboard"
      web_app:
        url: "https://app.example.com/{{ user_id }}"
```

#### Login URL Button
```yaml
buttons:
  - - text: "üîê Login"
      login_url:
        url: "https://example.com/login"
        forward_text: "Welcome {{ username }}"
        bot_username: "my_bot"
        request_write_access: true
```

#### Switch Inline Query Buttons
```yaml
buttons:
  - - text: "üîç Search Everywhere"
      switch_inline_query: "{{ search_term }}"
  - - text: "üîç Search Here"
      switch_inline_query_current_chat: "{{ query }}"
  - - text: "üì§ Share"
      switch_inline_query_chosen_chat:
        query: "Check out {{ product_name }}"
        allow_user_chats: true
        allow_bot_chats: false
        allow_group_chats: true
        allow_channel_chats: false
```

#### Copy Text Button
```yaml
buttons:
  - - text: "üìã Copy Code"
      copy_text:
        text: "PROMO-{{ code }}"
```

#### Pay & Game Buttons
```yaml
buttons:
  - - text: "üí≥ Pay $10.00"
      pay: true
  - - text: "üéÆ Play Game"
      callback_game: true
```

## Message Templates

Define reusable Jinja2 templates for consistent messaging:

```yaml
templates:
  order_notification: |
    üõí *New Order #{{ order_id }}*
    
    üë§ Customer: {{ customer_name }}
    üí∞ Total: ${{ total }}
    üì¶ Items: {{ items_count }}
    
    {% if notes %}üìù Notes: {{ notes }}{% endif %}

endpoints:
  - path: "/orders"
    chat_id: "123456789"
    template: "order_notification"
    parse_mode: "MarkdownV2"
```

Send with:
```bash
curl -X POST http://localhost:8000/orders \
  -H "Content-Type: application/json" \
  -d '{
    "order_id": "12345",
    "customer_name": "John Doe",
    "total": "99.99",
    "items_count": 3,
    "notes": "Urgent delivery"
  }'
```

## Field Mapping

Map nested JSON fields to FastBotty's expected fields:

```yaml
endpoints:
  - path: "/webhook/shopify"
    chat_id: "123456789"
    formatter: "plain"
    field_map:
      image_url: "product.featured_image"
      image_urls: "product.images"
      chat_id: "meta.notify_target"
```

## Deployment Options

### Local Development

```bash
# Start with auto-reload
fastbotty run --reload

# Or specify host/port
fastbotty run --host 0.0.0.0 --port 8000
```

### Docker

```dockerfile
FROM python:3.11-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY . .
CMD ["fastbotty", "run"]
```

```bash
docker build -t my-notifier .
docker run -p 8000:8000 \
  -e TELEGRAM_BOT_TOKEN="your-token" \
  -e API_KEY="your-secret-key" \
  -v $(pwd)/config.yaml:/app/config.yaml \
  my-notifier
```

### Docker Compose

```yaml
version: "3.8"
services:
  fastbotty:
    build: .
    ports:
      - "8000:8000"
    environment:
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - API_KEY=${API_KEY}
    volumes:
      - ./config.yaml:/app/config.yaml
      - ./plugins:/app/plugins
    restart: unless-stopped
```

### Cloud Platforms

#### Render.com
```bash
# Set environment variables in Render dashboard
# Start command: fastbotty run --host 0.0.0.0 --port $PORT
```

#### Railway.app
```bash
# Set environment variables
# Deploy automatically from GitHub
```

#### Fly.io
```bash
fly launch
fly secrets set TELEGRAM_BOT_TOKEN=your-token
fly secrets set API_KEY=your-secret-key
fly deploy
```

## Webhook Setup

```bash
# Register webhook with Telegram
fastbotty webhook setup

# Check webhook status
fastbotty webhook info

# Remove webhook
fastbotty webhook delete
```

## API Usage

### Sending Notifications

```bash
# Simple text message
curl -X POST http://localhost:8000/notify \
  -H "Content-Type: application/json" \
  -H "X-API-Key: your-secret-key" \
  -d '{"message": "Hello World!"}'

# With image
curl -X POST http://localhost:8000/notify \
  -H "Content-Type: application/json" \
  -d '{
    "message": "New product",
    "image_url": "https://example.com/product.jpg"
  }'

# Multiple images (gallery)
curl -X POST http://localhost:8000/notify \
  -H "Content-Type: application/json" \
  -d '{
    "message": "Product gallery",
    "image_urls": [
      "https://example.com/1.jpg",
      "https://example.com/2.jpg",
      "https://example.com/3.jpg"
    ]
  }'

# Override chat_id per request
curl -X POST http://localhost:8000/notify \
  -H "Content-Type: application/json" \
  -d '{
    "message": "Hello",
    "chat_id": "987654321"
  }'

# Broadcast to multiple chats
curl -X POST http://localhost:8000/notify \
  -H "Content-Type: application/json" \
  -d '{
    "message": "Broadcast",
    "chat_ids": ["123", "456", "789"]
  }'
```

## Reply Keyboards

FastBotty supports Telegram reply keyboards to replace the user's standard keyboard with custom buttons.

### Basic Reply Keyboard

```yaml
endpoints:
  - path: "/survey"
    chat_id: "123456789"
    formatter: "plain"
    reply_keyboard:
      keyboard:
        - ["üëç Good", "üëé Bad"]
        - ["üìù Feedback"]
      resize_keyboard: true
      one_time_keyboard: true
      input_field_placeholder: "Choose an option..."
```

### Special Request Buttons

Request contact or location from users:

```yaml
endpoints:
  - path: "/register"
    chat_id: "123456789"
    formatter: "plain"
    reply_keyboard:
      keyboard:
        - - text: "üìû Share Contact"
            request_contact: true
        - - text: "üìç Share Location"
            request_location: true
      resize_keyboard: true
```

### Reply Keyboard with Template

```yaml
endpoints:
  - path: "/order-menu"
    chat_id: "123456789"
    formatter: "plain"
    reply_keyboard:
      keyboard:
        - ["Confirm Order #{{ order_id }}", "Cancel Order #{{ order_id }}"]
      one_time_keyboard: true
```

### Force Reply

Force users to reply to a message:

```yaml
endpoints:
  - path: "/ask"
    chat_id: "123456789"
    formatter: "plain"
    force_reply:
      force_reply: true
      input_field_placeholder: "Type your answer..."
```

### Remove Reply Keyboard

```yaml
endpoints:
  - path: "/done"
    chat_id: "123456789"
    formatter: "plain"
    reply_keyboard_remove:
      remove_keyboard: true
```

## Media Types

### Documents

Send PDF files, documents, and other file types:

```bash
curl -X POST http://localhost:8000/notify \
  -H "Content-Type: application/json" \
  -d '{
    "message": "Monthly report",
    "document_url": "https://example.com/report.pdf",
    "filename": "report_dec_2024.pdf"
  }'
```

Configuration with field mapping:

```yaml
endpoints:
  - path: "/send-docs"
    chat_id: "123456789"
    formatter: "plain"
    field_map:
      document_url: "file.url"
      filename: "file.name"
```

### Videos

Send videos with optional thumbnails:

```bash
curl -X POST http://localhost:8000/notify \
  -H "Content-Type: application/json" \
  -d '{
    "message": "Product demo",
    "video_url": "https://example.com/demo.mp4",
    "thumbnail_url": "https://example.com/thumb.jpg",
    "width": 1920,
    "height": 1080,
    "duration": 120,
    "supports_streaming": true
  }'
```

### Audio

Send audio files (music) with metadata:

```bash
curl -X POST http://localhost:8000/notify \
  -H "Content-Type: application/json" \
  -d '{
    "message": "New podcast episode",
    "audio_url": "https://example.com/episode.mp3",
    "title": "Episode 42",
    "performer": "TechTalk",
    "duration": 3600
  }'
```

### Voice Messages

Send voice notes:

```bash
curl -X POST http://localhost:8000/notify \
  -H "Content-Type: application/json" \
  -d '{
    "message": "Voice message",
    "voice_url": "https://example.com/voice.ogg",
    "duration": 30
  }'
```

### Location Sharing

Send GPS coordinates with optional live tracking:

```bash
curl -X POST http://localhost:8000/notify \
  -H "Content-Type: application/json" \
  -d '{
    "message": "Delivery location",
    "location": {
      "latitude": 40.7128,
      "longitude": -74.0060,
      "live_period": 3600,
      "horizontal_accuracy": 50.0
    }
  }'
```

Configuration example:

```yaml
endpoints:
  - path: "/share-location"
    chat_id: "123456789"
    formatter: "plain"
    field_map:
      location: "delivery.gps_coordinates"
    buttons:
      - - text: "üó∫Ô∏è Open in Google Maps"
          url: "https://maps.google.com/?q={{ location.latitude }},{{ location.longitude }}"
```

### Response Format

**Success:**
```json
{
  "status": "sent",
  "results": [
    {"chat_id": "123", "message_id": 456}
  ]
}
```

**Error:**
```json
{
  "detail": {
    "error": "error_code",
    "message": "Error description"
  }
}
```

## Practical Examples

### E-commerce Order Notification

```yaml
endpoints:
  - path: "/orders"
    chat_id: "-1001234567890"  # Channel ID
    formatter: "markdown"
    parse_mode: "MarkdownV2"
    labels:
      order_id: "üÜî Order"
      customer: "üë§ Customer"
      total: "üí∞ Total"
      status: "üì¶ Status"
    buttons:
      - - text: "üì¶ Track Order #{{ order_id }}"
          url: "https://shop.com/track/{{ order_id }}"
      - - text: "üìã Copy Order ID"
          copy_text:
            text: "{{ order_id }}"
```

### CI/CD Pipeline Alerts

```yaml
endpoints:
  - path: "/ci/alerts"
    chat_id: "-1001234567890"
    formatter: "markdown"
    parse_mode: "MarkdownV2"
    labels:
      status: "üìä Status"
      branch: "üåø Branch"
      commit: "üìù Commit"
      author: "üë§ Author"
    buttons:
      - - text: "üîó View Build"
          url: "https://ci.example.com/builds/{{ build_id }}"
```

### Server Monitoring

```yaml
endpoints:
  - path: "/monitor/alerts"
    chat_id: "123456789"
    formatter: "plain"
    buttons:
      - - text: "‚úÖ Acknowledge"
          callback_data: "ack_{{ alert_id }}"
      - - text: "üöÄ Open Dashboard"
          web_app:
            url: "https://monitor.example.com/alerts/{{ alert_id }}"
```

### Multi-Channel Broadcast

```yaml
endpoints:
  - path: "/broadcast"
    chat_ids:
      - "123456789"              # User ID
      - "-1001234567890"         # Group ID
      - "@my_channel"            # Channel username
    formatter: "plain"
```

## Troubleshooting

### Common Issues

**Bot not sending messages:**
- Verify bot token is correct
- Ensure bot is added to the chat/group
- For channels, bot must be admin
- Check `fastbotty validate` output

**Invalid chat_id:**
- User ID: positive number (`123456789`)
- Group ID: negative number (`-123456789`)
- Supergroup/Channel: starts with `-100` (`-1001234567890`)
- Channel username: `@channel_name`

**Markdown parsing errors:**
- Use `parse_mode: "MarkdownV2"`
- Special characters are auto-escaped by FastBotty

### Validation

```bash
# Validate your config.yaml
fastbotty validate
```

## Health Check

```bash
curl http://localhost:8000/health
```

Response:
```json
{
  "status": "healthy",
  "endpoints": 2,
  "formatters": ["plain", "markdown", "custom_formatter"]
}
```

## Chat ID Formats

- **User ID**: `123456789` (positive number)
- **Group ID**: `-123456789` (negative number)
- **Supergroup/Channel**: `-1001234567890` (starts with -100)
- **Channel Username**: `@my_channel` (with @ prefix)

## Best Practices

1. **Use environment variables** for sensitive data (tokens, API keys)
2. **Enable API authentication** for production deployments
3. **Use templates** for consistent message formatting
4. **Leverage field mapping** for complex JSON payloads
5. **Test locally** before deploying to production
6. **Use webhooks** for button click handling
7. **Monitor health endpoint** for deployment status

## Resources

- **GitHub**: [github.com/venopyX/fastbotty](https://github.com/venopyX/fastbotty)
- **PyPI**: [pypi.org/project/fastbotty/](https://pypi.org/project/fastbotty/)
- **Documentation**: [USAGE.md](https://github.com/venopyX/fastbotty/blob/main/USAGE.md)
